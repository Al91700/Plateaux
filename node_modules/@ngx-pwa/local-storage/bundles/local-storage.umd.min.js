!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],t):t((e.ngxPWA=e.ngxPWA||{},e.ngxPWA.localStorage=e.ngxPWA.localStorage||{}),e.ng.core,e.ng.common,e.Rx,e.Rx.operators)}(this,function(e,t,r,n,o){"use strict";function i(e){return r.isPlatformBrowser(e)&&"indexedDB"in window&&void 0!==indexedDB&&null!==indexedDB?new a:r.isPlatformBrowser(e)&&"localStorage"in window&&void 0!==localStorage&&null!==localStorage?new s:new u}var a=function(){function e(){this.dbName="ngStorage",this.objectStoreName="localStorage",this.keyPath="key",this.dataPath="value",this.database=new n.ReplaySubject,this.connect()}return e.prototype.getItem=function(e){var t=this;return this.transaction().pipe(o.map(function(t){return t.get(e)}),o.mergeMap(function(e){var r=n.fromEvent(e,"success").pipe(o.map(function(e){return e.target.result}),o.map(function(e){return e&&t.dataPath in e?e[t.dataPath]:null}));return n.race(r,t.toErrorObservable(e,"getter")).pipe(o.first())}),o.first())},e.prototype.setItem=function(e,t){var r=this;return null==t?n.of(!0):this.getItem(e).pipe(o.map(function(e){return null==e?"add":"put"}),o.mergeMap(function(i){return r.transaction("readwrite").pipe(o.mergeMap(function(a){var s;switch(i){case"add":s=a.add((u={},u[r.dataPath]=t,u),e);break;case"put":default:s=a.put((p={},p[r.dataPath]=t,p),e)}return n.race(r.toSuccessObservable(s),r.toErrorObservable(s,"setter")).pipe(o.first());var u,p}))}),o.first())},e.prototype.removeItem=function(e){var t=this;return this.getItem(e).pipe(o.mergeMap(function(r){return null!=r?t.transaction("readwrite").pipe(o.mergeMap(function(r){var i=r.delete(e);return n.race(t.toSuccessObservable(i),t.toErrorObservable(i,"remover")).pipe(o.first())})):n.of(!0)}),o.first())},e.prototype.clear=function(){var e=this;return this.transaction("readwrite").pipe(o.mergeMap(function(t){var r=t.clear();return n.race(e.toSuccessObservable(r),e.toErrorObservable(r,"clearer")).pipe(o.first())}),o.first())},e.prototype.connect=function(){var e=this,t=indexedDB.open(this.dbName);n.fromEvent(t,"upgradeneeded").pipe(o.first()).subscribe(function(t){var r=t.target.result;r.objectStoreNames.contains(e.objectStoreName)||r.createObjectStore(e.objectStoreName)});var r=n.fromEvent(t,"success");n.race(r,this.toErrorObservable(t,"connection")).pipe(o.first()).subscribe(function(t){e.database.next(t.target.result)},function(t){e.database.error(t)})},e.prototype.transaction=function(e){var t=this;return void 0===e&&(e="readonly"),this.database.pipe(o.map(function(r){return r.transaction([t.objectStoreName],e).objectStore(t.objectStoreName)}))},e.prototype.toSuccessObservable=function(e){return n.fromEvent(e,"success").pipe(o.map(function(){return!0}))},e.prototype.toErrorObservable=function(e,t){return void 0===t&&(t=""),n.fromEvent(e,"error").pipe(o.mergeMap(function(r){return n.throwError(new Error("IndexedDB "+t+" issue : "+e.error.message+"."))}))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),s=function(){function e(){this.localStorage=localStorage}return e.prototype.getItem=function(e){var t=this.localStorage.getItem(e),r=null;if(null!=t)try{r=JSON.parse(t)}catch(e){return n.throwError(new Error("Invalid data in localStorage."))}return n.of(r)},e.prototype.setItem=function(e,t){return this.localStorage.setItem(e,JSON.stringify(t)),n.of(!0)},e.prototype.removeItem=function(e){return this.localStorage.removeItem(e),n.of(!0)},e.prototype.clear=function(){return this.localStorage.clear(),n.of(!0)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),u=function(){function e(){this.localStorage=new Map}return e.prototype.getItem=function(e){var t=this.localStorage.get(e);return n.of(void 0!==t?t:null)},e.prototype.setItem=function(e,t){return this.localStorage.set(e,t),n.of(!0)},e.prototype.removeItem=function(e){return this.localStorage.delete(e),n.of(!0)},e.prototype.clear=function(){return this.localStorage.clear(),n.of(!0)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),p=function(){function e(){}return e.decorators=[{type:t.Injectable,args:[{providedIn:"root",useFactory:i,deps:[t.PLATFORM_ID]}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return i(t.inject(t.PLATFORM_ID))},token:e,providedIn:"root"}),e}(),c=function(){function e(){}return e.prototype.validate=function(e,t){if(!this.isObjectNotNull(t))throw new Error("A schema must be an object (unlike spec, booleans are not supported to enforce strict types).");if(!((t.hasOwnProperty("const")||t.hasOwnProperty("enum")||t.hasOwnProperty("type"))&&"array"!==t.type&&"object"!==t.type||t.hasOwnProperty("properties")||t.hasOwnProperty("items")))throw new Error("Each value must have a 'type' or 'properties' or 'items' or 'const' or 'enum', to enforce strict types.");if(t.hasOwnProperty("const")&&e!==t.const)return!1;if(t.hasOwnProperty("enum")&&!this.validateEnum(e,t))return!1;if(t.hasOwnProperty("type")&&!this.validateType(e,t))return!1;if(t.hasOwnProperty("items")&&!this.validateItems(e,t))return!1;if(t.hasOwnProperty("properties")){if(t.hasOwnProperty("required")&&!this.validateRequired(e,t))return!1;if(!this.validateProperties(e,t))return!1}return!0},e.prototype.isObjectNotNull=function(e){return null!==e&&"object"==typeof e},e.prototype.validateProperties=function(e,t){if(!this.isObjectNotNull(e))return!1;if(!t.properties||!this.isObjectNotNull(t.properties))throw new Error("'properties' must be a schema object.");if(Object.keys(t.properties).length!==Object.keys(e).length)return!1;for(var r in t.properties)if(t.properties.hasOwnProperty(r)&&e.hasOwnProperty(r)&&!this.validate(e[r],t.properties[r]))return!1;return!0},e.prototype.validateRequired=function(e,t){if(!this.isObjectNotNull(e))return!1;if(!Array.isArray(t.required))throw new Error("'required' field must be an array. Note that since JSON Schema draft 6, booleans are not supported anymore.");for(var r=0,n=t.required;r<n.length;r++){var o=n[r];if("string"!=typeof o)throw new Error("'required' array must contain strings only.");if(!t.properties||!t.properties.hasOwnProperty(o))throw new Error("'required' properties must be described in 'properties' too.");if(!e.hasOwnProperty(o))return!1}return!0},e.prototype.validateEnum=function(e,t){if(!Array.isArray(t.enum))throw new Error("'enum' must be an array.");return-1!==t.enum.indexOf(e)},e.prototype.validateType=function(e,t){if(Array.isArray(t.type))return this.validateTypeList(e,t);if("string"!=typeof t.type)throw new Error("'type' must be a string (arrays of types are not supported yet).");return("null"!==t.type||null===e)&&("string"===t.type?this.validateString(e,t):"number"===t.type||"integer"===t.type?this.validateNumber(e,t):("boolean"!==t.type||"boolean"==typeof e)&&("object"!==t.type||"object"==typeof e))},e.prototype.validateTypeList=function(e,t){for(var r=[],n=0,o=t.type;n<o.length;n++){var i=o[n];r.push(this.validateType(e,{type:i}))}return-1!==r.indexOf(!0)},e.prototype.validateItems=function(e,t){if(!Array.isArray(e))return!1;if(t.hasOwnProperty("maxItems")){if("number"!=typeof t.maxItems||!Number.isInteger(t.maxItems)||t.maxItems<0)throw new Error("'maxItems' must be a non-negative integer.");if(e.length>t.maxItems)return!1}if(t.hasOwnProperty("minItems")){if("number"!=typeof t.minItems||!Number.isInteger(t.minItems)||t.minItems<0)throw new Error("'minItems' must be a non-negative integer.");if(e.length<t.minItems)return!1}if(t.hasOwnProperty("uniqueItems")){if("boolean"!=typeof t.uniqueItems)throw new Error("'minItems' must be a boolean.");if(t.uniqueItems){var r=new Set(e);if(e.length!==r.size)return!1}}if(Array.isArray(t.items))return this.validateItemsList(e,t);if(!t.items||!this.isObjectNotNull(t.items))throw new Error("'items' must be a schema object.");for(var n=0,o=e;n<o.length;n++){var i=o[n];if(!this.validate(i,t.items))return!1}return!0},e.prototype.validateItemsList=function(e,t){var r=t.items;if(e.length!==r.length)return!1;for(var n=0;n<r.length;n+=1)if(!this.validate(e[n],r[n]))return!1;return!0},e.prototype.validateString=function(e,t){if("string"!=typeof e)return!1;if(t.hasOwnProperty("maxLength")){if("number"!=typeof t.maxLength||!Number.isInteger(t.maxLength)||t.maxLength<0)throw new Error("'maxLength' must be a non-negative integer.");if(e.length>t.maxLength)return!1}if(t.hasOwnProperty("minLength")){if("number"!=typeof t.minLength||!Number.isInteger(t.minLength)||t.minLength<0)throw new Error("'minLength' must be a non-negative integer.");if(e.length<t.minLength)return!1}if(t.hasOwnProperty("pattern")){if("string"!=typeof t.pattern)throw new Error("'pattern' must be a string with a valid RegExp.");if(!new RegExp(t.pattern).test(e))return!1}return!0},e.prototype.validateNumber=function(e,t){if("number"!=typeof e)return!1;if("integer"===t.type&&!Number.isInteger(e))return!1;if(t.hasOwnProperty("multipleOf")){if("number"!=typeof t.multipleOf||t.multipleOf<=0)throw new Error("'multipleOf' must be a number strictly greater than 0.");if(!Number.isInteger(e/t.multipleOf))return!1}if(t.hasOwnProperty("maximum")){if("number"!=typeof t.maximum)throw new Error("'maximum' must be a number.");if(e>t.maximum)return!1}if(t.hasOwnProperty("exclusiveMaximum")){if("number"!=typeof t.exclusiveMaximum)throw new Error("'exclusiveMaximum' must be a number.");if(e>=t.exclusiveMaximum)return!1}if(t.hasOwnProperty("minimum")){if("number"!=typeof t.minimum)throw new Error("'minimum' must be a number.");if(e<t.minimum)return!1}if(t.hasOwnProperty("exclusiveMinimum")){if("number"!=typeof t.exclusiveMinimum)throw new Error("'exclusiveMinimum' must be a number.");if(e<=t.exclusiveMinimum)return!1}return!0},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),f=function(){function e(e,t){this.database=e,this.jsonValidator=t,this.getItemOptionsDefault={schema:null}}return e.prototype.getItem=function(e,t){var r=this;return void 0===t&&(t=this.getItemOptionsDefault),this.database.getItem(e).pipe(o.mergeMap(function(e){if(t.schema&&null!==e){var o=!0;try{o=r.jsonValidator.validate(e,t.schema)}catch(e){return n.throwError(e)}if(!o)return n.throwError(new Error("JSON invalid"))}return n.of(e)}))},e.prototype.setItem=function(e,t){return this.database.setItem(e,t)},e.prototype.removeItem=function(e){return this.database.removeItem(e)},e.prototype.clear=function(){return this.database.clear()},e.prototype.setItemSubscribe=function(e,t){this.setItem(e,t).subscribe(function(){},function(){})},e.prototype.removeItemSubscribe=function(e){this.removeItem(e).subscribe(function(){},function(){})},e.prototype.clearSubscribe=function(){this.clear().subscribe(function(){},function(){})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:p},{type:c}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(p),t.inject(c))},token:e,providedIn:"root"}),e}();e.LocalDatabase=p,e.IndexedDBDatabase=a,e.LocalStorageDatabase=s,e.MockLocalDatabase=u,e.JSONValidator=c,e.LocalStorage=f,e.ɵa=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=local-storage.umd.min.js.map
